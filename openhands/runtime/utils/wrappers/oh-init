#!/bin/bash
# /openhands/bin/oh-init

# Set up environment variables
export PATH=/openhands/bin:$PATH
export LD_LIBRARY_PATH=/openhands/lib:$LD_LIBRARY_PATH
export POETRY_VIRTUALENVS_PATH=/openhands/poetry
export MAMBA_ROOT_PREFIX=/openhands/micromamba
export PLAYWRIGHT_BROWSERS_PATH=/openhands/browser/ms-playwright
export OPENVSCODE_SERVER_ROOT=/openhands/.openvscode-server

# Create the openhands user if it doesn't exist
if ! id -u openhands > /dev/null 2>&1; then
  echo "Creating openhands user..."
  if command -v useradd > /dev/null 2>&1; then
    # For Debian/Ubuntu-based systems
    groupadd -g 1000 openhands 2>/dev/null || true
    useradd -u 1000 -g 1000 -m -s /bin/bash openhands 2>/dev/null || true
  elif command -v adduser > /dev/null 2>&1; then
    # For Alpine-based systems
    addgroup -g 1000 openhands 2>/dev/null || true
    adduser -D -u 1000 -G openhands openhands 2>/dev/null || true
  fi
fi

# Create and set permissions for workspace directory
mkdir -p /workspace
chown -R openhands:openhands /workspace /openhands 2>/dev/null || true

echo "OpenHands environment initialized successfully!"