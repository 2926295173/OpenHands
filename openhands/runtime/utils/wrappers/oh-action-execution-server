#!/bin/bash
# /openhands/bin/oh-action-execution-server

# Set up environment
export PATH=/openhands/micromamba/bin:$PATH
export MAMBA_ROOT_PREFIX=/openhands/micromamba
export POETRY_VIRTUALENVS_PATH=/openhands/poetry
export PLAYWRIGHT_BROWSERS_PATH=/openhands/browser/ms-playwright
export LD_LIBRARY_PATH=/openhands/lib:$LD_LIBRARY_PATH

# Default values
PORT=${1:-8000}
WORKING_DIR=${2:-/workspace}
PLUGINS=${3:-""}

# Build the command
CMD="/openhands/micromamba/bin/micromamba run -n openhands poetry run python -m openhands.runtime.action_execution_server $PORT --working-dir $WORKING_DIR"

# Add plugins if specified
if [ -n "$PLUGINS" ]; then
  CMD="$CMD --plugins $PLUGINS"
fi

# Execute the command
exec $CMD